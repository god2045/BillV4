{"version":3,"file":"statBill.js","sources":["pages/statBill/statBill.vue","../../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc3RhdEJpbGwvc3RhdEJpbGwudnVl"],"sourcesContent":["<template>\r\n  <view class=\"charts-box\">\r\n    <qiun-data-charts type=\"column\" :chartData=\"chartData\" :opts=\"opts\" />\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\n  import {\r\n    ref\r\n  } from 'vue';\r\n  import {\r\n    onShow\r\n  } from '@dcloudio/uni-app';\r\n  let chartData = ref({})\r\n  let opts = ref({\r\n    color: [\"#91CB74\", \"#EE6666\"],\r\n    padding: [15, 15, 0, 5],\r\n    enableScroll: false,\r\n    xAxis: {\r\n      disableGrid: true\r\n    },\r\n    yAxis: {\r\n      data: [{\r\n        min: 0\r\n      }]\r\n    },\r\n    extra: {\r\n      column: {\r\n        type: \"group\",\r\n        width: 15,\r\n        activeBgColor: \"#000000\",\r\n        activeBgOpacity: 0.08\r\n      }\r\n    }\r\n  })\r\n\r\n  async function getBillData(startDate, endDate) {\r\n    return await uniCloud.callFunction({\r\n      name: \"fun\",\r\n      data: {\r\n        api: \"billData\",\r\n        startDate,\r\n        endDate\r\n      }\r\n    })\r\n  }\r\n\r\n  function getWeekDay(day) {\r\n    const weekDays = ['日', '一', '二', '三', '四', '五', '六'];\r\n    return `星期${weekDays[day]}`;\r\n  }\r\n\r\n  function getLastSevenDays() {\r\n    const days = [];\r\n    const today = new Date();\r\n\r\n    for (let i = 6; i >= 0; i--) {\r\n      const date = new Date(today);\r\n      date.setDate(today.getDate() - i);\r\n\r\n      const year = date.getFullYear();\r\n      const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份从0开始，需要+1\r\n      const day = String(date.getDate()).padStart(2, '0');\r\n\r\n      days.push({\r\n        date: `${year}-${month}-${day}`, // 完整日期\r\n        year: year,\r\n        month: month,\r\n        day: day,\r\n        week: getWeekDay(date.getDay()), // 星期几\r\n        timestamp: date.getTime() // 时间戳\r\n      });\r\n    }\r\n\r\n    return days;\r\n  }\r\n\r\n  function generateExpenseIncomeArrays(data, dates) {\r\n    // 创建支出和收入的Map\r\n    const expenseMap = new Map();\r\n    const incomeMap = new Map();\r\n\r\n    // 分类存储数据\r\n    data.forEach(item => {\r\n      if (item.typeLX === '支出') {\r\n        expenseMap.set(item.date, item.total);\r\n      } else if (item.typeLX === '收入') {\r\n        incomeMap.set(item.date, item.total);\r\n      }\r\n    });\r\n\r\n    // 生成数组\r\n    const expenseArray = dates.map(date => -expenseMap.get(date) || 0);\r\n    const incomeArray = dates.map(date => incomeMap.get(date) || 0);\r\n\r\n    return {\r\n      expense: expenseArray,\r\n      income: incomeArray\r\n    };\r\n  }\r\n\r\n  async function getServerData() {\r\n    let days = getLastSevenDays()\r\n    let date = []\r\n    let inData = []\r\n    let outData = []\r\n    let categories = []\r\n    days.map((items) => {\r\n      categories.push(items.week)\r\n      date.push(items.date)\r\n    })\r\n\r\n    const billData = await getBillData(date[0], date[6])\r\n    console.log(\"billData的值\", billData.result.data)\r\n    const dataB = billData.result.data\r\n    console.log(\"dataB的值\", dataB)\r\n    const inOutData = generateExpenseIncomeArrays(dataB, date)\r\n    inData = inOutData.income\r\n    outData = inOutData.expense\r\n    console.log(inData)\r\n\r\n    let res = {\r\n      categories,\r\n      series: [{\r\n          name: \"收入\",\r\n          data: inData\r\n        },\r\n        {\r\n          name: \"支出\",\r\n          data: outData\r\n        }\r\n      ]\r\n    };\r\n    chartData.value = JSON.parse(JSON.stringify(res));\r\n  }\r\n  onShow(() => {\r\n    getServerData()\r\n  })\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .charts-box {\r\n    width: 100%;\r\n    height: 300px;\r\n  }\r\n</style>","import MiniProgramPage from 'C:/Users/10459/Desktop/BillV4/BillV4/pages/statBill/statBill.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","uni","onShow"],"mappings":"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"}