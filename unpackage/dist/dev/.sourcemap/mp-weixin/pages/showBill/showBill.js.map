{"version":3,"file":"showBill.js","sources":["pages/showBill/showBill.vue","../../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2hvd0JpbGwvc2hvd0JpbGwudnVl"],"sourcesContent":["<template>\r\n  <view class=\"title\">\r\n    <view class=\"card\">\r\n      <view class=\"card-select\">\r\n        <button type=\"primary\" @click=\"dateBill(dayDate,dayDate)\">今日</button>\r\n        <button type=\"primary\"\r\n          @click=\"dateBill(getCurrentMonthRange().startDate,getCurrentMonthRange().endDate)\">本月</button>\r\n        <button type=\"primary\"\r\n          @click=\"dateBill(getCurrentQuarterRange().startDate,getCurrentQuarterRange().endDate)\">本季度</button>\r\n      </view>\r\n      <scroll-view class=\"sview\" scroll-y=\"true\" @scrolltolower='scrollLower(status)'>\r\n        <view v-if=\"showNotData\">暂无数据</view>\r\n        <view v-for=\"item in billList\" :key=\"item._id\" class=\"bList\">\r\n          <img class=\"icard\" src=\"../../static/logo.png\" />\r\n          <view class=\"icard\">\r\n            <view class=\"icard-type\" :style=\"{color:item.isType}\">{{item.typeLX}}</view>\r\n            <view class=\"icard-date\">{{item.date}}</view>\r\n          </view>\r\n          <view class=\"icard line\">\r\n            <text class=\"icard-b\">{{item.typeLB}}{{item.content}}</text>\r\n          </view>\r\n          <view class=\"icard \">\r\n            <text class=\"icard-money\">{{item.money}}</text>\r\n          </view>\r\n        </view>\r\n      </scroll-view>\r\n      <view class=\"showCount\">\r\n        <text>{{selectObject.startDate}}</text>\r\n        <text>~{{selectObject.endDate}}</text>\r\n        <text>列表展示：{{count}}条</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n\r\n</template>\r\n\r\n<script setup>\r\n  import {\r\n    onMounted,\r\n    ref\r\n  } from 'vue';\r\n  import {\r\n    onShow,\r\n    onPullDownRefresh,\r\n    onPageScroll\r\n  } from '@dcloudio/uni-app'\r\n  let dayDate = ref(formatDate(new Date()))\r\n  let billList = ref([])\r\n  let status = ref('true')\r\n  let selectObject = ref({\r\n    startDate: dayDate,\r\n    endDate: dayDate,\r\n    page: -1,\r\n    size: 10,\r\n  })\r\n  let count = ref(0)\r\n  let showNotData = ref(false)\r\n\r\n  let selectSave = ref({\r\n    startDate: '',\r\n    endDate: '',\r\n    page: '',\r\n    size: '',\r\n  })\r\n\r\n  function formatDate(date) {\r\n    // const now = new Date()\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n  }\r\n\r\n  function getCurrentMonthRange() {\r\n    const now = new Date();\r\n    const year = now.getFullYear();\r\n    const month = now.getMonth() + 1; // 月份从0开始，所以要+1\r\n    const startDate = new Date(year, month - 1, 1);\r\n    // 获取下个月的第一天，然后减一天得到本月最后一天\r\n    const endDate = new Date(year, month, 0);\r\n    return {\r\n      startDate: formatDate(startDate),\r\n      endDate: formatDate(endDate)\r\n    };\r\n  }\r\n\r\n  function getCurrentQuarterRange() {\r\n    const now = new Date();\r\n    const year = now.getFullYear();\r\n    const month = now.getMonth() + 1; // 月份从0开始，所以要+1\r\n    // 计算季度\r\n    let quarterStartMonth;\r\n    let quarterEndMonth;\r\n    if (month >= 1 && month <= 3) {\r\n      quarterStartMonth = 1;\r\n      quarterEndMonth = 3;\r\n    } else if (month >= 4 && month <= 6) {\r\n      quarterStartMonth = 4;\r\n      quarterEndMonth = 6;\r\n    } else if (month >= 7 && month <= 9) {\r\n      quarterStartMonth = 7;\r\n      quarterEndMonth = 9;\r\n    } else {\r\n      quarterStartMonth = 10;\r\n      quarterEndMonth = 12;\r\n    }\r\n    // 季度开始日期\r\n    const startDate = new Date(year, quarterStartMonth - 1, 1);\r\n    // 季度结束日期（下个季度的第一天减一天）\r\n    const endDate = new Date(year, quarterEndMonth, 0);\r\n    return {\r\n      startDate: formatDate(startDate),\r\n      endDate: formatDate(endDate)\r\n    };\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  // function dateSelect()\r\n\r\n  function dateBill(startDate, endDate, page = 0, size = 10) {\r\n    const select = selectObject.value\r\n    const sameParams = startDate === select.startDate &&\r\n      endDate === select.endDate &&\r\n      page === select.page\r\n    if (!sameParams) {\r\n      billList.value = []\r\n      count.value = 0\r\n    }\r\n\r\n    const currentPage = sameParams ? page + 1 : page\r\n    selectObject.value = {\r\n      startDate,\r\n      endDate,\r\n      page: currentPage,\r\n      size\r\n    }\r\n    uniCloud.callFunction({\r\n      name: \"fun\",\r\n      data: {\r\n        api: \"showBill\",\r\n        startDate,\r\n        endDate,\r\n        page: currentPage * 10,\r\n        size\r\n      }\r\n    }).then(res => {\r\n      console.log(res)\r\n      const result = res.result\r\n      count.value += result.affectedDocs\r\n      showNotData.value = count.value <= 0\r\n      status.value = !(result.data.length === 0)\r\n      if (status.value) {\r\n        result.data.map(item => ({\r\n          ...item,\r\n          content: item.content ? `(${item.content})` : '',\r\n          isType: item.typeLX === '支出' ? 'red' : 'green'\r\n        }))\r\n        billList.value = [...billList.value, ...result.data]\r\n      }\r\n    })\r\n  }\r\n\r\n  function scrollLower(type) {\r\n    let select = selectObject.value\r\n    if (type === true) {\r\n      dateBill(select.startDate, select.endDate, select.page, select.size)\r\n      return\r\n    }\r\n    return\r\n  }\r\n\r\n  onShow(() => {\r\n    dateBill(dayDate.value, dayDate.value)\r\n  })\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .title {\r\n    background-color: rgba(241, 255, 243, 1);\r\n    height: 100vh;\r\n\r\n    .card {\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      height: 100%;\r\n\r\n      .card-select {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        width: 92%;\r\n        margin-top: 10%;\r\n      }\r\n\r\n      .sview {\r\n        height: 55vh;\r\n        margin-top: 30rpx;\r\n        width: 80vw;\r\n        border: 1.77rpx solid rgba(0, 98, 144, 1.0);\r\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\r\n      }\r\n\r\n      .showCount {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-end;\r\n        width: 80vw;\r\n      }\r\n\r\n      .bList {\r\n        margin: 21rpx;\r\n        // border: 1px solid #ccc;\r\n        width: 624rpx;\r\n        height: 92.44rpx;\r\n\r\n        display: flex;\r\n        align-items: center;\r\n\r\n        .icard {\r\n          width: 20%;\r\n          // height: 61.9rpx;\r\n          height: 100%;\r\n          padding: 5rpx 10rpx;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: center;\r\n\r\n          .icard-date {\r\n            font-size: 20.93rpx;\r\n            font-weight: 600;\r\n            letter-spacing: 0rpx;\r\n            line-height: 29.3rpx;\r\n            color: rgba(0, 104, 255, 1);\r\n            text-align: left;\r\n            vertical-align: middle;\r\n            font-family: \"Poppins\", sans-serif;\r\n          }\r\n\r\n          .icard-type {\r\n            height: 61.9rpx;\r\n            font-size: 26.16rpx;\r\n            font-weight: 500;\r\n            letter-spacing: 0rpx;\r\n            line-height: 36.63rpx;\r\n            color: rgba(5, 34, 36, 1);\r\n            text-align: left;\r\n            vertical-align: middle;\r\n          }\r\n\r\n          .icard-b {\r\n            text-overflow: ellipsis;\r\n            display: -webkit-box;\r\n            -webkit-box-orient: vertical;\r\n            -webkit-line-clamp: 3;\r\n            /* 显示行数 */\r\n            overflow: hidden;\r\n            text-overflow: ellipsis;\r\n            overflow: hidden;\r\n            font-size: 22.67rpx;\r\n            font-weight: 300;\r\n            letter-spacing: 0rpx;\r\n            line-height: 26.16rpx;\r\n            color: rgba(5, 34, 36, 1);\r\n            text-align: center;\r\n            vertical-align: middle;\r\n          }\r\n\r\n          .icard-money {\r\n            font-size: 26.16rpx;\r\n            font-weight: 500;\r\n            letter-spacing: 0rpx;\r\n            line-height: 92.44rpx;\r\n            color: rgba(5, 34, 36, 1);\r\n            text-align: center;\r\n            vertical-align: middle;\r\n          }\r\n        }\r\n\r\n        .line {\r\n          border-left: 1.77rpx solid rgba(0, 208, 158, 1);\r\n          border-right: 1.77rpx solid rgba(0, 208, 158, 1);\r\n        }\r\n\r\n\r\n      }\r\n    }\r\n  }\r\n</style>","import MiniProgramPage from 'C:/Users/10459/Desktop/BillV4/BillV4/pages/showBill/showBill.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uniCloud","uni","onShow"],"mappings":";;;;;;AAqCA,QAAA,UAAAA,cAAA,IAAA,WAAA,oBAAA,KAAA,CAAA,CAAA;AAUA,QAAA,WAAAA,cAAA,IAAA,EAAA;AACA,QAAA,SAAAA,cAAA,IAAA,MAAA;AACA,QAAA,eAAAA,cAAAA,IAAA;AAAA,MACA,WAAA;AAAA,MACA,SAAA;AAAA,MACA,MAAA;AAAA,MACA,MAAA;AAAA,IACA,CAAA;AACA,QAAA,QAAAA,cAAA,IAAA,CAAA;AACA,QAAA,cAAAA,cAAA,IAAA,KAAA;AAEAA,sBAAA;AAAA,MACA,WAAA;AAAA,MACA,SAAA;AAAA,MACA,MAAA;AAAA,MACA,MAAA;AAAA,IACA,CAAA;AAEA,aAAA,WAAA,MAAA;AAEA,YAAA,OAAA,KAAA;AACA,YAAA,QAAA,OAAA,KAAA,SAAA,IAAA,CAAA,EAAA,SAAA,GAAA,GAAA;AACA,YAAA,MAAA,OAAA,KAAA,QAAA,CAAA,EAAA,SAAA,GAAA,GAAA;AACA,aAAA,GAAA,IAAA,IAAA,KAAA,IAAA,GAAA;AAAA,IACA;AAEA,aAAA,uBAAA;AACA,YAAA,MAAA,oBAAA;AACA,YAAA,OAAA,IAAA;AACA,YAAA,QAAA,IAAA,SAAA,IAAA;AACA,YAAA,YAAA,IAAA,KAAA,MAAA,QAAA,GAAA,CAAA;AAEA,YAAA,UAAA,IAAA,KAAA,MAAA,OAAA,CAAA;AACA,aAAA;AAAA,QACA,WAAA,WAAA,SAAA;AAAA,QACA,SAAA,WAAA,OAAA;AAAA,MACA;AAAA,IACA;AAEA,aAAA,yBAAA;AACA,YAAA,MAAA,oBAAA;AACA,YAAA,OAAA,IAAA;AACA,YAAA,QAAA,IAAA,SAAA,IAAA;AAEA,UAAA;AACA,UAAA;AACA,UAAA,SAAA,KAAA,SAAA,GAAA;AACA,4BAAA;AACA,0BAAA;AAAA,MACA,WAAA,SAAA,KAAA,SAAA,GAAA;AACA,4BAAA;AACA,0BAAA;AAAA,MACA,WAAA,SAAA,KAAA,SAAA,GAAA;AACA,4BAAA;AACA,0BAAA;AAAA,MACA,OAAA;AACA,4BAAA;AACA,0BAAA;AAAA,MACA;AAEA,YAAA,YAAA,IAAA,KAAA,MAAA,oBAAA,GAAA,CAAA;AAEA,YAAA,UAAA,IAAA,KAAA,MAAA,iBAAA,CAAA;AACA,aAAA;AAAA,QACA,WAAA,WAAA,SAAA;AAAA,QACA,SAAA,WAAA,OAAA;AAAA,MACA;AAAA,IACA;AAQA,aAAA,SAAA,WAAA,SAAA,OAAA,GAAA,OAAA,IAAA;AACA,YAAA,SAAA,aAAA;AACA,YAAA,aAAA,cAAA,OAAA,aACA,YAAA,OAAA,WACA,SAAA,OAAA;AACA,UAAA,CAAA,YAAA;AACA,iBAAA,QAAA,CAAA;AACA,cAAA,QAAA;AAAA,MACA;AAEA,YAAA,cAAA,aAAA,OAAA,IAAA;AACA,mBAAA,QAAA;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAA;AAAA,QACA;AAAA,MACA;AACAC,oBAAAA,GAAA,aAAA;AAAA,QACA,MAAA;AAAA,QACA,MAAA;AAAA,UACA,KAAA;AAAA,UACA;AAAA,UACA;AAAA,UACA,MAAA,cAAA;AAAA,UACA;AAAA,QACA;AAAA,MACA,CAAA,EAAA,KAAA,SAAA;AACAC,sBAAAA,MAAA,MAAA,OAAA,sCAAA,GAAA;AACA,cAAA,SAAA,IAAA;AACA,cAAA,SAAA,OAAA;AACA,oBAAA,QAAA,MAAA,SAAA;AACA,eAAA,QAAA,EAAA,OAAA,KAAA,WAAA;AACA,YAAA,OAAA,OAAA;AACA,iBAAA,KAAA,IAAA,WAAA;AAAA,YACA,GAAA;AAAA,YACA,SAAA,KAAA,UAAA,IAAA,KAAA,OAAA,MAAA;AAAA,YACA,QAAA,KAAA,WAAA,OAAA,QAAA;AAAA,UACA,EAAA;AACA,mBAAA,QAAA,CAAA,GAAA,SAAA,OAAA,GAAA,OAAA,IAAA;AAAA,QACA;AAAA,MACA,CAAA;AAAA,IACA;AAEA,aAAA,YAAA,MAAA;AACA,UAAA,SAAA,aAAA;AACA,UAAA,SAAA,MAAA;AACA,iBAAA,OAAA,WAAA,OAAA,SAAA,OAAA,MAAA,OAAA,IAAA;AACA;AAAA,MACA;AACA;AAAA,IACA;AAEAC,kBAAAA,OAAA,MAAA;AACA,eAAA,QAAA,OAAA,QAAA,KAAA;AAAA,IACA,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/KA,GAAG,WAAW,eAAe;"}